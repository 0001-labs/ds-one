---
import MyHeader from '../components/MyHeader.astro';
import MySidebar from '../components/MySidebar.astro';
import MyHead from '../components/MyHead.astro';

interface Props {
  title?: string;
}

const { title } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title || 'DS One'}</title>
    <MyHead />
  </head>
  <body>
    <ds-grid align="left"></ds-grid>
    
    <!-- Header -->
    <MyHeader />

    <!-- Mobile Sidebar Overlay -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <!-- Main Container with Sidebar and Content -->
    <div class="main-container">
      <!-- Sidebar -->
      <aside id="sidebar" class="sidebar">
        <MySidebar />
      </aside>

      <!-- Sidebar gap (desktop only) -->
      <div class="sidebar-gap"></div>

      <!-- Main Content -->
      <main class="main-content">
        <slot />
      </main>
    </div>

    <style is:global>
      * {
        font-family: 'GT-America-Standard-Regular', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        box-sizing: border-box;
      }

      html, body {
        margin: 0;
        padding: 0;
        background: var(--ds1-docs-sidebar-bg);
        color: var(--ds1-docs-header-text);
      }

      body {
        overflow-x: hidden;
      }

      /* Main container */
      .main-container {
        display: flex;
        height: calc(100vh - 60px);
        overflow: hidden;
      }

      /* Sidebar */
      .sidebar {
        width: 280.5px;
        min-width: 280.5px;
        border-right: 1px solid var(--ds1-docs-header-border);
        overflow-y: auto;
        background: var(--ds1-docs-sidebar-bg);
        z-index: 100;
      }

      /* Sidebar gap */
      .sidebar-gap {
        width: 20px;
        min-width: 20px;
        height: 100%;
        background: var(--ds1-docs-sidebar-bg);
        border-right: 1px solid var(--ds1-docs-header-border);
      }

      /* Main content */
      .main-content {
        flex: 1;
        overflow-y: auto;
      }

      /* Sidebar overlay (mobile) */
      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 99;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .sidebar-overlay.active {
        opacity: 1;
      }

      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: light-dark(#c0c0c0, #3a3a3a);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: light-dark(#a0a0a0, #4a4a4a);
      }

      /* Mobile Responsive Styles */
      @media (max-width: 768px) {
        .main-container {
          height: calc(100vh - 60px);
        }

        .sidebar {
          position: fixed;
          top: 60px;
          left: 0;
          height: calc(100vh - 60px);
          transform: translateX(-100%);
          transition: transform 0.3s ease;
          box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar.open {
          transform: translateX(0);
        }

        .sidebar-gap {
          display: none;
        }

        .sidebar-overlay {
          display: block;
          pointer-events: none;
          top: 60px;
        }

        .sidebar-overlay.active {
          pointer-events: auto;
        }

        .main-content {
          width: 100%;
        }
      }

      /* Tablet adjustments */
      @media (max-width: 1024px) and (min-width: 769px) {
        .sidebar {
          width: 250px;
          min-width: 250px;
        }

        .sidebar-gap {
          width: 15px;
          min-width: 15px;
        }
      }
    </style>

    <script is:inline>
      // Mobile sidebar toggle functionality
      document.addEventListener('DOMContentLoaded', function() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        const menuButton = document.getElementById('mobile-menu-btn');

        function openSidebar() {
          sidebar?.classList.add('open');
          overlay?.classList.add('active');
          document.body.style.overflow = 'hidden';
        }

        function closeSidebar() {
          sidebar?.classList.remove('open');
          overlay?.classList.remove('active');
          document.body.style.overflow = '';
        }

        // Menu button click
        menuButton?.addEventListener('click', function() {
          if (sidebar?.classList.contains('open')) {
            closeSidebar();
          } else {
            openSidebar();
          }
        });

        // Close on overlay click
        overlay?.addEventListener('click', closeSidebar);

        // Close sidebar when clicking a link (for mobile navigation)
        const sidebarLinks = sidebar?.querySelectorAll('ds-button[href]');
        sidebarLinks?.forEach(link => {
          link.addEventListener('click', function() {
            if (window.innerWidth <= 768) {
              closeSidebar();
            }
          });
        });

        // Close sidebar on escape key
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && sidebar?.classList.contains('open')) {
            closeSidebar();
          }
        });

        // Handle resize - close mobile sidebar when switching to desktop
        window.addEventListener('resize', function() {
          if (window.innerWidth > 768 && sidebar?.classList.contains('open')) {
            closeSidebar();
          }
        });
      });
    </script>
  </body>
</html>
